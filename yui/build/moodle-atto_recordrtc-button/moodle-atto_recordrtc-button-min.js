YUI.add("moodle-atto_recordrtc-button",function(e,t){var n="atto_recordrtc",r="recordrtc",i=!1;e.namespace("M.atto_recordrtc").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){var e,t;e=this.get("allowedtypes"),console.info(this.get("recordrtcurl"));if(e=="both"||e=="audio")console.info("Add button for audio "+this.get("audiortcicon")+" "+M.util.get_string("audiortc",n)),t=this.addButton({icon:this.get("audiortcicon"),iconComponent:n,buttonName:M.util.get_string("audiortc",n),callback:this._toggle}),t.set("title",M.util.get_string("audiortc",n));if(e=="both"||e=="video")console.info("Add button for video "+this.get("videortcicon")+" "+M.util.get_string("videortc",n)),t=this.addButton({icon:this.get("videortcicon"),iconComponent:n,buttonName:M.util.get_string("videortc",n),callback:this._toggleVideoRTC}),t.set("title",M.util.get_string("videortc",n))},_toggle:function(e){console.info("Toogle audio..."),e.preventDefault(),this._toggle_action()},_toggleVideoRTC:function(e){console.info("Toogle video..."),e.preventDefault(),this._toggle_action()},_toggle_action:function(){console.info("Toogle action...");var t=this.buttons[r],n=e.one("#id_submitbutton");t.getData(i)?(this.unHighlightButtons(r),this._setrecordrtc(t),n.set("disabled",!1),n.removeClass("disabled")):(this.highlightButtons(r),this._setrecordrtc(t,!0),n.set("disabled",!0),n.addClass("disabled"))},_fitToScreen:function(){console.info("Fit to screen...");var e=this.buttons[r];if(!e.getData(i))return;var t=this.get("host");this.recordrtc.setStyles({position:"absolute",height:t.editor.getComputedStyle("height"),width:t.editor.getComputedStyle("width"),top:t.editor.getComputedStyle("top"),left:t.editor.getComputedStyle("left")}),this.recordrtc.setY(this.editor.getY())},_setrecordrtc:function(t,n){console.info("Set recordRTC...");var r=this.get("host");if(n){this.recordrtc=e.Node.create('<iframe src="'+this.get("recordrtcurl")+"?sesskey="+this.get("sesskey")+"&contextid="+this.get("contextid")+"&content="+encodeURIComponent(r.textarea.get("value"))+'" srcdoc=""></iframe'),this.recordrtc.setStyles({backgroundColor:e.one("body").getComputedStyle("backgroundColor"),backgroundImage:"url("+M.util.image_url("i/loading","core")+")",backgroundRepeat:"no-repeat",backgroundPosition:"center center"}),r._wrapper.appendChild(this.recordrtc);var s={sesskey:this.get("sesskey"),contextid:this.get("contextid"),content:r.textarea.get("value")};e.io(this.get("recordrtcurl"),{context:this,data:s,on:{complete:this._loadContent},method:"POST"}),r.disablePlugins(),r.enablePlugins(this.name),typeof e.M.atto_fullscreen!="undefined"&&r.enablePlugins("fullscreen")}else this.recordrtc.remove(!0),r.enablePlugins();t.setData(i,!!n),this._fitToScreen()},_loadContent:function(e,t){console.info("Load content...");var n=t.responseText;this.recordrtc.setAttribute("srcdoc",n)}},{ATTRS:{recordrtcroot:{value:null},recordrtcurl:{value:null},contextid:{value:null},sesskey:{value:null},allowedtypes:{value:null},audiobitrate:{value:null},videobitrate:{value:null},timelimit:{value:null},audiortcicon:{value:null},videortcicon:{value:null}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
