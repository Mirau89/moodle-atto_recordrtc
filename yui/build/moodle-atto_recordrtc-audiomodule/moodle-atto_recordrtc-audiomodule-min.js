YUI.add("moodle-atto_recordrtc-audiomodule",function(e,t){M.tinymce_recordrtc.view_init=function(){player=document.querySelector("audio#player"),startStopBtn=document.querySelector("button#start-stop"),uploadBtn=document.querySelector("button#upload"),recType="audio",maxUploadSize=parseInt(recordrtc.maxfilesize.match(/\d+/)[0])*Math.pow(1024,2),M.tinymce_recordrtc.check_secure(),M.tinymce_recordrtc.check_browser(),startStopBtn.onclick=function(){var e=this;e.disabled=!0;if(e.textContent===M.util.get_string("startrecording","tinymce_recordrtc")||e.textContent===M.util.get_string("recordagain","tinymce_recordrtc")||e.textContent===M.util.get_string("recordingfailed","tinymce_recordrtc")){var t=document.querySelector("div[id=alert-danger]");t.parentElement.parentElement.classList.add("hide"),player.parentElement.parentElement.classList.add("hide"),uploadBtn.parentElement.parentElement.classList.add("hide"),recordrtc.oldermoodle||(startStopBtn.classList.remove("btn-outline-danger"),startStopBtn.classList.add("btn-danger")),chunks=[],blobSize=0;var n={onMediaCaptured:function(t){e.stream=t,e.mediaCapturedCallback&&e.mediaCapturedCallback()},onMediaStopped:function(t){e.textContent=t},onMediaCapturingFailed:function(e){var t=null;if(e.name==="PermissionDeniedError"&&bowser.firefox)InstallTrigger.install({Foo:{URL:"https://addons.mozilla.org/en-US/firefox/addon/enable-screen-capturing/",toString:function(){return this.URL}}}),t=M.util.get_string("startrecording","tinymce_recordrtc");else if(e.name==="DevicesNotFoundError"||e.name==="NotFoundError"){var r=document.querySelector("div[id=alert-danger]");r.parentElement.parentElement.classList.remove("hide"),r.textContent=M.util.get_string("inputdevicealert_title","tinymce_recordrtc")+" "+M.util.get_string("inputdevicealert","tinymce_recordrtc"),t=M.util.get_string("recordingfailed","tinymce_recordrtc")}n.onMediaStopped(t)}};M.tinymce_recordrtc.captureAudio(n),e.mediaCapturedCallback=function(){M.tinymce_recordrtc.startRecording(recType,e.stream)}}else clearInterval(countdownTicker),setTimeout(function(){e.disabled=!1},1e3),M.tinymce_recordrtc.stopRecording(e.stream),e.textContent=M.util.get_string("recordagain","tinymce_recordrtc"),recordrtc.oldermoodle||(startStopBtn.classList.remove("btn-danger"),startStopBtn.classList.add("btn-outline-danger"))}},M.tinymce_recordrtc.captureAudio=function(e){M.tinymce_recordrtc.captureUserMedia({audio:!0},function(t){player.srcObject=t,e.onMediaCaptured(t)},function(t){e.onMediaCapturingFailed(t)})},M.tinymce_recordrtc.stopRecording=function(e){mediaRecorder.stop(),e.getTracks().forEach(function(e){e.stop()});var t=new Blob(chunks);player.src=URL.createObjectURL(t),player.muted=!1,player.controls=!0,player.parentElement.parentElement.classList.remove("hide"),uploadBtn.parentElement.parentElement.classList.remove("hide"),uploadBtn.textContent=M.util.get_string("attachrecording","tinymce_recordrtc"),uploadBtn.disabled=!1,uploadBtn.onclick=function(){if(!player.src||chunks===[])return window.alert(M.util.get_string("norecordingfound","tinymce_recordrtc"));var e=uploadBtn;return e.disabled=!0,M.tinymce_recordrtc.uploadToServer(recType,function(t,n){t==="ended"?(e.disabled=!1,M.tinymce_recordrtc.insert_annotation(recType,n)):t==="upload-failed"?(e.disabled=!1,e.textContent=M.util.get_string("uploadfailed","tinymce_recordrtc")+" "+n):t==="upload-failed-404"?(e.disabled=!1,e.textContent=M.util.get_string("uploadfailed404","tinymce_recordrtc")):t==="upload-aborted"?(e.disabled=!1,e.textContent=M.util.get_string("uploadaborted","tinymce_recordrtc")+" "+n):e.textContent=t}),undefined}}},"@VERSION@",{requires:["moodle-atto_recordrtc-commonmodule"]});
